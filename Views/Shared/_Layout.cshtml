@using System.Security.Claims
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - coop-ms</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/bms.styles.css" asp-append-version="true" />

<style>
    .admin-dropdown-toggle {
        border: 1px solid #dc3545; 
        border-radius: 5px;
        padding: 0.375rem 0.75rem;
    }

    .dropdown-submenu {
        position: relative;
    }

    .dropdown-submenu > .dropdown-menu {
        top: 0;
        left: 100%;
        margin-top: -5px; 
        margin-left: 0px;
        display: none;
    }

    .dropdown-submenu:hover > .dropdown-menu,
    .dropdown-submenu > .dropdown-menu.show {
        display: block !important;
    }

    @@media (min-width: 992px) {
        .dropdown-submenu:hover > .dropdown-menu {
            display: block !important;
        }
    }

    .dropdown-submenu > .dropdown-toggle::after {
        display: none !important;
    }

    .dropdown-submenu > a.dropdown-item {
        position: relative;
        padding-right: 2.5rem !important;
    }

    .dropdown-submenu > a.dropdown-item::after {
        content: "▶" !important;
        position: absolute !important;
        right: 1rem !important;
        top: 50% !important;
        transform: translateY(-50%) !important;
        font-size: 0.75em !important;
        color: rgba(255, 255, 255, 0.5) !important;
    }

    /* COMPACT DROPDOWN STYLING WITH DIVIDER LINES */
    .dropdown-menu {
        padding: 0 !important;
        min-width: 200px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3) !important;
    }

    .dropdown-menu li {
        border-bottom: 1px solid rgba(255, 255, 255, 0.15) !important;
    }

    .dropdown-menu li:last-child {
        border-bottom: none !important;
    }

    .dropdown-item {
        padding: 0.5rem 1rem !important;
        font-size: 0.9rem;
        transition: all 0.2s ease;
        border-bottom: none !important;
    }

    .dropdown-item:hover {
        padding-left: 1.2rem !important;
    }

    .dropdown-divider {
        margin: 0 !important;
        border-color: rgba(255, 255, 255, 0.15) !important;
        opacity: 1 !important;
    }

    .dropdown-item-text {
        padding: 0.5rem 1rem !important;
    }

    /* Button in dropdown (Logout button) */
    .dropdown-item[type="submit"] {
        width: 100%;
        text-align: left;
        background: none;
        border: none;
    }

    /* Submenu specific styling */
    .dropdown-submenu > .dropdown-menu li {
        border-bottom: 1px solid rgba(255, 255, 255, 0.15) !important;
    }

    .dropdown-submenu > .dropdown-menu li:last-child {
        border-bottom: none !important;
    }
</style>
</head>
<body>
<header>
<nav class="navbar navbar-expand-sm navbar-toggleable-sm navbar-light bg-white border-bottom box-shadow mb-3">
<div class="container-fluid">

<a class="navbar-brand" asp-area="" asp-controller="Home" asp-action="Index">coop-ms</a>

<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent">
    <span class="navbar-toggler-icon"></span>
</button>

<div class="collapse navbar-collapse" id="navbarSupportedContent">

<ul class="navbar-nav me-auto">

<li class="nav-item">
<a class="nav-link text-dark" asp-controller="Home" asp-action="Index">Home</a>
</li>

<li class="nav-item">
<a class="nav-link text-dark" asp-controller="Home" asp-action="About">About</a>
</li>

<li class="nav-item">
<a class="nav-link text-dark" asp-controller="Home" asp-action="Privacy">Privacy</a>
</li>

@if (User.Identity?.IsAuthenticated == true)
{
<!-- Member -->
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown">
Member
</a>
<ul class="dropdown-menu">
<li><a class="dropdown-item" asp-controller="Member" asp-action="Index">Show Members</a></li>
<li><a class="dropdown-item" asp-controller="Member" asp-action="Create">Add Member</a></li>
</ul>
</li>

<!-- Member Share -->
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown">
Member Share
</a>
<ul class="dropdown-menu">

<li class="dropdown-submenu">
<a class="dropdown-item" href="#">Buy Share</a>
<ul class="dropdown-menu">

<li>
<a class="dropdown-item"
asp-controller="MemberShare"
asp-action="AddShare"
asp-route-shareType="Ordinary">
Ordinary Share
</a>
</li>

<li>
<a class="dropdown-item"
asp-controller="MemberShare"
asp-action="AddShare"
asp-route-shareType="Additional">
Additional Share
</a>
</li>

</ul>
</li>
<li>
<a class="dropdown-item"
asp-controller="MemberShare"
asp-action="ViewMemberSharesDetails">
View Share Details
</a>
</li>

<li>
<a class="dropdown-item"
asp-controller="MemberShare"
asp-action="Index">
View Active Members
</a>
</li>

</ul>
</li>


<!-- Member Accounts -->
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown">
Member Accounts
</a>
<ul class="dropdown-menu">
<li>
<a class="dropdown-item" asp-controller="MemberAccount" asp-action="Create">
Add Accounts
</a>
</li>
<li>
<a class="dropdown-item" asp-controller="MemberAccount" asp-action="SelectAccount">
View Account Details
</a>
</li>
</ul>
</li>

<!-- Transactions -->
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown">
Transactions
</a>
<ul class="dropdown-menu">
<li>
<a class="dropdown-item" asp-controller="AccountTransaction" asp-action="AddTransaction" asp-route-transactionType="Deposit">
Deposit
</a>
</li>
<li>
<a class="dropdown-item" asp-controller="AccountTransaction" asp-action="AddTransaction" asp-route-transactionType="Withdrawal">
Withdrawal
</a>
</li>
<li><hr class="dropdown-divider"></li>
<li>
<a class="dropdown-item" asp-controller="AccountTransaction" asp-action="SelectStatement">
View Statement
</a>
</li>
</ul>
</li>
}
</ul>

<ul class="navbar-nav ms-auto align-items-center">

@if (User.IsInRole("Admin"))
{
<li class="nav-item dropdown me-2">
<a class="nav-link dropdown-toggle text-danger admin-dropdown-toggle" href="#" data-bs-toggle="dropdown">
Admin Panel
</a>
<ul class="dropdown-menu dropdown-menu-end">
<li><a class="dropdown-item" asp-controller="Admin" asp-action="Users">Manage staff members</a></li>
<li><a class="dropdown-item" asp-controller="Admin" asp-action="Register">Add new staff member</a></li>
</ul>
</li>
}

@if (User.Identity.IsAuthenticated)
{
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown">
@User.Identity.Name
</a>
<ul class="dropdown-menu dropdown-menu-end">
<li><span class="dropdown-item-text"><small>Role: @User.FindFirst(ClaimTypes.Role)?.Value</small></span></li>
<li><hr class="dropdown-divider"></li>
<li>
<form asp-controller="Account" asp-action="Logout" method="post">
<button type="submit" class="dropdown-item">Logout</button>
</form>
</li>
</ul>
</li>
}
else
{
<li class="nav-item">
<a class="nav-link" asp-controller="Account" asp-action="Login">Login</a>
</li>
}

</ul>
</div>
</div>
</nav>
</header>

<div class="container">
<main role="main" class="pb-3">
@RenderBody()
</main>
</div>

<footer class="border-top footer text-muted">
<div class="container">
&copy; 2026 - bms - <a asp-controller="Home" asp-action="Privacy">Privacy</a>
</div>
</footer>

<script src="~/lib/jquery/dist/jquery.min.js"></script>
<script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
<script src="~/js/site.js" asp-append-version="true"></script>

<script>
setTimeout(function() {
var alerts = document.querySelectorAll('.alert');
alerts.forEach(function(alert) {
new bootstrap.Alert(alert).close();
});
}, 3000);

document.querySelectorAll('.dropdown-submenu > a').forEach(function(element) {
element.addEventListener('click', function(e) {
e.preventDefault();
e.stopPropagation();
const submenu = this.nextElementSibling;
if(submenu) submenu.classList.toggle('show');
});
});
</script>

@await RenderSectionAsync("Scripts", required: false)
</body>
</html>