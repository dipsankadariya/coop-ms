@model bms.ViewModels.HomeVm

@{
    ViewData["Title"] = "Dashboard";
}

<div class="container py-5">
    <h2 class="fw-bold text-white mb-4">Dashboard</h2>

    <!-- Stats Cards Row -->
    <div class="row g-4 mb-4">
        <!-- Members Card -->
        <div class="col-md-6 col-lg-3">
            <div class="card bg-dark border-0 shadow-sm h-100">
                <div class="card-body">
                    <div class="d-flex align-items-center mb-3">
                        <div class="rounded-circle bg-primary bg-opacity-25 p-3 me-3">
                            <i class="bi bi-people-fill fs-4 text-primary"></i>
                        </div>
                        <div>
                            <h6 class="text-muted mb-0">Members</h6>
                            <h3 class="text-white mb-0">@Model.TotalMembers</h3>
                        </div>
                    </div>
                    <div class="d-flex justify-content-between small">
                        <span class="text-success">Active: @Model.ActiveMembers</span>
                        <span class="text-danger">Inactive: @Model.InactiveMembers</span>
                    </div>
                </div>
                <div class="card-footer bg-transparent border-top border-secondary">
                    @if (User.IsInRole("Admin") || User.IsInRole("Staff"))
                    {
                        <a asp-controller="Member" asp-action="Index" class="text-primary text-decoration-none small">
                            View Members →
                        </a>
                    }
                    else
                    {
                        <span class="text-muted small">Members</span>
                    }
                </div>
            </div>
        </div>

        <!-- Staff Card -->
        <div class="col-md-6 col-lg-3">
            <div class="card bg-dark border-0 shadow-sm h-100">
                <div class="card-body">
                    <div class="d-flex align-items-center mb-3">
                        <div class="rounded-circle bg-warning bg-opacity-25 p-3 me-3">
                            <i class="bi bi-person-badge-fill fs-4 text-warning"></i>
                        </div>
                        <div>
                            <h6 class="text-muted mb-0">Staff</h6>
                            <h3 class="text-white mb-0">@Model.TotalStaff</h3>
                        </div>
                    </div>
                    <div class="d-flex justify-content-between small">
                        <span class="text-success">Active: @Model.ActiveStaff</span>
                        <span class="text-danger">Inactive: @Model.InactiveStaff</span>
                    </div>
                </div>
                <div class="card-footer bg-transparent border-top border-secondary">
                    @if (User.IsInRole("Admin"))
                    {
                        <a asp-controller="Admin" asp-action="Users" class="text-warning text-decoration-none small">
                            Manage Staff →
                        </a>
                    }
                    else
                    {
                        <span class="text-muted small">Staff Members</span>
                    }
                </div>
            </div>
        </div>

        <!-- Admins Card -->
        <div class="col-md-6 col-lg-3">
            <div class="card bg-dark border-0 shadow-sm h-100">
                <div class="card-body">
                    <div class="d-flex align-items-center mb-3">
                        <div class="rounded-circle bg-danger bg-opacity-25 p-3 me-3">
                            <i class="bi bi-shield-lock-fill fs-4 text-danger"></i>
                        </div>
                        <div>
                            <h6 class="text-muted mb-0">Admins</h6>
                            <h3 class="text-white mb-0">@Model.Admins</h3>
                        </div>
                    </div>
                    <div class="d-flex justify-content-between small">
                        <span class="text-success">Active: @Model.ActiveAdmins</span>
                        <span class="text-danger">Inactive: @Model.InactiveAdmins</span>
                    </div>
                </div>
                <div class="card-footer bg-transparent border-top border-secondary">
                    <span class="text-muted small">Administrators</span>
                </div>
            </div>
        </div>

        <!-- Accounts Card -->
        <div class="col-md-6 col-lg-3">
            <div class="card bg-dark border-0 shadow-sm h-100">
                <div class="card-body">
                    <div class="d-flex align-items-center mb-3">
                        <div class="rounded-circle bg-success bg-opacity-25 p-3 me-3">
                            <i class="bi bi-wallet2 fs-4 text-success"></i>
                        </div>
                        <div>
                            <h6 class="text-muted mb-0">Accounts</h6>
                            <h3 class="text-white mb-0">@Model.TotalAccounts</h3>
                        </div>
                    </div>
                    <div class="d-flex justify-content-between small">
                        <span class="text-success">Active: @Model.ActiveAccounts</span>
                        <span class="text-danger">Inactive: @Model.InactiveAccounts</span>
                    </div>
                </div>
                <div class="card-footer bg-transparent border-top border-secondary">
                    <a asp-controller="MemberAccount" asp-action="SelectAccount" class="text-success text-decoration-none small">
                        View Accounts →
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts Row -->
    <div class="row g-4">
        <!-- Transaction Types Chart -->
        <div class="col-md-6">
            <div class="card bg-dark border-0 shadow-sm">
                <div class="card-header bg-transparent border-bottom border-secondary">
                    <h5 class="text-white mb-0"><i class="bi bi-bar-chart-fill me-2"></i>Transaction Overview</h5>
                </div>
                <div class="card-body">
                    <div class="row mb-3">
                        <div class="col-6 text-center">
                            <h4 class="text-success mb-0">₹@Model.TotalDeposits.ToString("N0")</h4>
                            <small class="text-muted">Total Deposits</small>
                        </div>
                        <div class="col-6 text-center">
                            <h4 class="text-danger mb-0">₹@Model.TotalWithdrawals.ToString("N0")</h4>
                            <small class="text-muted">Total Withdrawals</small>
                        </div>
                    </div>
                    <div style="height: 200px;">
                        <canvas id="transactionChart"></canvas>
                    </div>
                    <div class="text-center mt-3">
                        <span class="badge bg-secondary">Total Transactions: @Model.TotalTransactions</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Account Types Chart -->
        <div class="col-md-6">
            <div class="card bg-dark border-0 shadow-sm">
                <div class="card-header bg-transparent border-bottom border-secondary">
                    <h5 class="text-white mb-0"><i class="bi bi-pie-chart-fill me-2"></i>Account Distribution</h5>
                </div>
                <div class="card-body">
                    <div style="height: 200px;">
                        <canvas id="accountTypeChart"></canvas>
                    </div>
                    <div class="row mt-3 text-center small">
                        <div class="col-3">
                            <span class="text-primary">Savings</span><br/>
                            <strong class="text-white">@Model.SavingsAccounts</strong>
                        </div>
                        <div class="col-3">
                            <span class="text-success">Current</span><br/>
                            <strong class="text-white">@Model.CurrentAccounts</strong>
                        </div>
                        <div class="col-3">
                            <span class="text-warning">Fixed Deposit</span><br/>
                            <strong class="text-white">@Model.FixedDepositAccounts</strong>
                        </div>
                        <div class="col-3">
                            <span class="text-info">Loan</span><br/>
                            <strong class="text-white">@Model.LoanAccounts</strong>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Transaction Chart (Bar Chart)
        new Chart(document.getElementById('transactionChart'), {
            type: 'bar',
            data: {
                labels: ['Deposits', 'Withdrawals'],
                datasets: [{
                    label: 'Count',
                    data: [@Model.DepositCount, @Model.WithdrawalCount],
                    backgroundColor: ['rgba(40, 167, 69, 0.8)', 'rgba(220, 53, 69, 0.8)'],
                    borderColor: ['rgb(40, 167, 69)', 'rgb(220, 53, 69)'],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    y: { beginAtZero: true, ticks: { color: '#adb5bd' }, grid: { color: 'rgba(255,255,255,0.1)' } },
                    x: { ticks: { color: '#adb5bd' }, grid: { display: false } }
                }
            }
        });

        // Account Type Chart (Pie Chart)
        new Chart(document.getElementById('accountTypeChart'), {
            type: 'pie',
            data: {
                labels: ['Savings', 'Current', 'Fixed Deposit', 'Loan'],
                datasets: [{
                    data: [@Model.SavingsAccounts, @Model.CurrentAccounts, @Model.FixedDepositAccounts, @Model.LoanAccounts],
                    backgroundColor: ['rgba(13, 110, 253, 0.8)', 'rgba(40, 167, 69, 0.8)', 'rgba(255, 193, 7, 0.8)', 'rgba(13, 202, 240, 0.8)'],
                    borderColor: ['rgb(13, 110, 253)', 'rgb(40, 167, 69)', 'rgb(255, 193, 7)', 'rgb(13, 202, 240)'],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } }
            }
        });
    </script>
}